{
  "info": {
    "name": "Punchout API",
    "description": "Collection for testing Punchout Session APIs",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:8080",
      "type": "string"
    },
    {
      "key": "gatewayUrl",
      "value": "http://localhost:9090",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "üöÄ Complete E2E Test",
      "item": [
        {
          "name": "Complete PunchOut Flow - E2E Test",
          "event": [
            {
              "listen": "test",
              "script": {
                "type": "text/javascript",
                "exec": [
                  "// Parse the response XML",
                  "const responseXml = pm.response.text();",
                  "",
                  "// Extract session key from response",
                  "const sessionKeyMatch = responseXml.match(/<BuyerCookie>([^<]+)<\\/BuyerCookie>/);",
                  "if (sessionKeyMatch) {",
                  "    const sessionKey = sessionKeyMatch[1];",
                  "    pm.collectionVariables.set('lastSessionKey', sessionKey);",
                  "    console.log('‚úÖ Session created: ' + sessionKey);",
                  "    ",
                  "    pm.test('PunchOut Setup Successful', function() {",
                  "        pm.expect(responseXml).to.include('StartPage');",
                  "        pm.expect(responseXml).to.include('URL');",
                  "        pm.expect(responseXml).to.include('BuyerCookie');",
                  "    });",
                  "    ",
                  "    // Fetch network requests from UI Backend after 1 second delay",
                  "    const uiBackendUrl = pm.collectionVariables.get('baseUrl');",
                  "    ",
                  "    setTimeout(function() {",
                  "        pm.sendRequest({",
                  "            url: `${uiBackendUrl}/api/v1/sessions/${sessionKey}/network-requests`,",
                  "            method: 'GET'",
                  "        }, function(err, response) {",
                  "        if (err) {",
                  "            console.error('‚ùå Failed to fetch network requests:', err);",
                  "        } else {",
                  "            const requests = response.json();",
                  "            console.log('\\nüìä NETWORK REQUESTS LOGGED IN UI DASHBOARD:');",
                  "            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\\n');",
                  "            ",
                  "            requests.forEach((req, index) => {",
                  "                console.log(`Request #${index + 1}: ${req.requestId}`);",
                  "                console.log(`  Direction: ${req.direction}`);",
                  "                console.log(`  URL: ${req.url || req.endpoint}`);",
                  "                console.log(`  Method: ${req.method}`);",
                  "                console.log(`  Status: ${req.statusCode}`);",
                  "                console.log(`  Timestamp: ${req.timestamp}`);",
                  "                ",
                  "                if (req.requestPayload) {",
                  "                    console.log(`  üì§ Request Payload: ${JSON.stringify(req.requestPayload).substring(0, 200)}...`);",
                  "                }",
                  "                ",
                  "                if (req.responsePayload) {",
                  "                    console.log(`  üì• Response Payload: ${JSON.stringify(req.responsePayload).substring(0, 200)}...`);",
                  "                }",
                  "                console.log('');",
                  "            });",
                  "            ",
                  "            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');",
                  "            console.log(`\\nüîó View in UI Dashboard: http://localhost:3000/sessions/${sessionKey}\\n`);",
                  "            ",
                  "            pm.test('Network Requests Logged', function() {",
                  "                pm.expect(requests.length).to.be.above(0);",
                  "            });",
                  "        }",
                  "        });",
                  "    }, 1000);",
                  "} else {",
                  "    pm.test('Failed to extract session key', function() {",
                  "        pm.expect.fail('Could not find BuyerCookie in response');",
                  "    });",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "text/xml",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<cXML payloadID=\"{{$randomInt}}\" timestamp=\"{{$isoTimestamp}}\">\n  <Header>\n    <From>\n      <Credential domain=\"NetworkID\">\n        <Identity>buyer123</Identity>\n      </Credential>\n    </From>\n    <To>\n      <Credential domain=\"NetworkID\">\n        <Identity>supplier456</Identity>\n      </Credential>\n    </To>\n    <Sender>\n      <Credential domain=\"NetworkID\">\n        <Identity>buyerApp</Identity>\n        <SharedSecret>secret123</SharedSecret>\n      </Credential>\n      <UserAgent>BuyerApp 1.0</UserAgent>\n    </Sender>\n  </Header>\n  <Request>\n    <PunchOutSetupRequest operation=\"create\">\n      <BuyerCookie>SESSION_TEST_{{$randomInt}}</BuyerCookie>\n      <Extrinsic name=\"User\">john.doe@example.com</Extrinsic>\n      <BrowserFormPost>\n        <URL>https://buyer.example.com/punchout/return</URL>\n      </BrowserFormPost>\n      <Contact role=\"buyer\">\n        <Name xml:lang=\"en\">John Doe</Name>\n        <Email>john.doe@example.com</Email>\n      </Contact>\n    </PunchOutSetupRequest>\n  </Request>\n</cXML>"
            },
            "url": {
              "raw": "{{gatewayUrl}}/punchout/setup",
              "host": ["{{gatewayUrl}}"],
              "path": ["punchout", "setup"]
            },
            "description": "üöÄ Complete End-to-End Test:\n\n1. Sends PunchOut setup request to Gateway\n2. Gateway processes cXML and calls Mock services\n3. All network requests are logged to MongoDB\n4. Test automatically fetches and displays all logged network requests\n5. Shows request/response payloads in Postman console\n\n‚úÖ Run this single test to see all network activity logged in the UI dashboard!\n\nüìä After running:\n- Check Postman Console (bottom panel) for detailed network request logs\n- Visit the UI Dashboard link shown in the console\n- All requests/responses are stored in MongoDB"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Gateway API (cXML)",
      "item": [
        {
          "name": "Health Check",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{gatewayUrl}}/punchout/health",
              "host": ["{{gatewayUrl}}"],
              "path": ["punchout", "health"]
            },
            "description": "Check gateway service health"
          },
          "response": []
        },
        {
          "name": "PunchOut Setup Request",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "text/xml",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<cXML payloadID=\"1234567890\" timestamp=\"2024-01-15T10:30:00-05:00\">\n  <Header>\n    <From>\n      <Credential domain=\"NetworkID\">\n        <Identity>buyer123</Identity>\n      </Credential>\n    </From>\n    <To>\n      <Credential domain=\"NetworkID\">\n        <Identity>supplier456</Identity>\n      </Credential>\n    </To>\n    <Sender>\n      <Credential domain=\"NetworkID\">\n        <Identity>buyerApp</Identity>\n        <SharedSecret>secret123</SharedSecret>\n      </Credential>\n      <UserAgent>BuyerApp 1.0</UserAgent>\n    </Sender>\n  </Header>\n  <Request>\n    <PunchOutSetupRequest operation=\"create\">\n      <BuyerCookie>COOKIE_12345_ABC</BuyerCookie>\n      <Extrinsic name=\"User\">john.doe@example.com</Extrinsic>\n      <BrowserFormPost>\n        <URL>https://buyer.example.com/punchout/return</URL>\n      </BrowserFormPost>\n      <Contact role=\"buyer\">\n        <Name xml:lang=\"en\">John Doe</Name>\n        <Email>john.doe@example.com</Email>\n      </Contact>\n    </PunchOutSetupRequest>\n  </Request>\n</cXML>"
            },
            "url": {
              "raw": "{{gatewayUrl}}/punchout/setup",
              "host": ["{{gatewayUrl}}"],
              "path": ["punchout", "setup"]
            },
            "description": "Send PunchOut setup request (cXML format). Gateway will:\n1. Parse cXML\n2. Authenticate with auth service\n3. Call catalog service\n4. Return cXML response with catalog URL"
          },
          "response": []
        },
        {
          "name": "PunchOut Order Message",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "text/xml",
                "type": "text"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<cXML payloadID=\"9876543210\" timestamp=\"2024-01-15T11:00:00-05:00\">\n  <Header>\n    <From>\n      <Credential domain=\"NetworkID\">\n        <Identity>supplier456</Identity>\n      </Credential>\n    </From>\n    <To>\n      <Credential domain=\"NetworkID\">\n        <Identity>buyer123</Identity>\n      </Credential>\n    </To>\n    <Sender>\n      <Credential domain=\"NetworkID\">\n        <Identity>catalogApp</Identity>\n        <SharedSecret>secret456</SharedSecret>\n      </Credential>\n      <UserAgent>CatalogApp 1.0</UserAgent>\n    </Sender>\n  </Header>\n  <Message>\n    <PunchOutOrderMessage>\n      <BuyerCookie>COOKIE_12345_ABC</BuyerCookie>\n      <PunchOutOrderMessageHeader operationAllowed=\"create\">\n        <Total>\n          <Money currency=\"USD\">1250.00</Money>\n        </Total>\n      </PunchOutOrderMessageHeader>\n      <ItemIn quantity=\"10\">\n        <ItemID>\n          <SupplierPartID>PROD-001</SupplierPartID>\n        </ItemID>\n        <ItemDetail>\n          <UnitPrice>\n            <Money currency=\"USD\">125.00</Money>\n          </UnitPrice>\n          <Description xml:lang=\"en\">Sample Product</Description>\n        </ItemDetail>\n      </ItemIn>\n    </PunchOutOrderMessage>\n  </Message>\n</cXML>"
            },
            "url": {
              "raw": "{{gatewayUrl}}/punchout/order",
              "host": ["{{gatewayUrl}}"],
              "path": ["punchout", "order"]
            },
            "description": "Send PunchOut order message (cXML format). Gateway will log the request and return success response."
          },
          "response": []
        }
      ]
    },
    {
      "name": "Sessions API (MongoDB)",
      "item": [
        {
          "name": "Get All Sessions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions"]
            },
            "description": "Retrieve all punchout sessions from MongoDB"
          },
          "response": []
        },
        {
          "name": "Get Session by Key",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions/:sessionKey",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions", ":sessionKey"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key to retrieve"
                }
              ]
            },
            "description": "Retrieve a specific punchout session by session key"
          },
          "response": []
        },
        {
          "name": "Get Session - Example 2",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions/:sessionKey",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions", ":sessionKey"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_002_DEF456",
                  "description": "The session key to retrieve"
                }
              ]
            },
            "description": "Retrieve session 2"
          },
          "response": []
        },
        {
          "name": "Get Session - Example 3",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions/:sessionKey",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions", ":sessionKey"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_003_GHI789",
                  "description": "The session key to retrieve"
                }
              ]
            },
            "description": "Retrieve session 3"
          },
          "response": []
        }
      ]
    },
    {
      "name": "PunchOut Sessions API (General)",
      "item": [
        {
          "name": "Get All PunchOut Sessions",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/punchout-sessions",
              "host": ["{{baseUrl}}"],
              "path": ["api", "punchout-sessions"]
            },
            "description": "Retrieve all punchout sessions from the general API"
          },
          "response": []
        },
        {
          "name": "Get PunchOut Session by Key",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/punchout-sessions/:sessionKey",
              "host": ["{{baseUrl}}"],
              "path": ["api", "punchout-sessions", ":sessionKey"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key to retrieve"
                }
              ]
            },
            "description": "Retrieve a specific punchout session by session key"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Order Object API",
      "item": [
        {
          "name": "Get Order Object",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/punchout-sessions/:sessionKey/order-object",
              "host": ["{{baseUrl}}"],
              "path": ["api", "punchout-sessions", ":sessionKey", "order-object"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key"
                }
              ]
            },
            "description": "Get order object for a specific session"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Gateway Request API",
      "item": [
        {
          "name": "Get Gateway Requests",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/punchout-sessions/:sessionKey/gateway-requests",
              "host": ["{{baseUrl}}"],
              "path": ["api", "punchout-sessions", ":sessionKey", "gateway-requests"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key"
                }
              ]
            },
            "description": "Get gateway requests for a specific session"
          },
          "response": []
        }
      ]
    },
    {
      "name": "Network Requests API",
      "item": [
        {
          "name": "Get All Network Requests for Session",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions/:sessionKey/network-requests",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions", ":sessionKey", "network-requests"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key"
                }
              ]
            },
            "description": "Get all network requests (inbound and outbound) for a specific session"
          },
          "response": []
        },
        {
          "name": "Get Inbound Requests Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions/:sessionKey/network-requests/inbound",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions", ":sessionKey", "network-requests", "inbound"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key"
                }
              ]
            },
            "description": "Get only inbound network requests for a specific session"
          },
          "response": []
        },
        {
          "name": "Get Outbound Requests Only",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/sessions/:sessionKey/network-requests/outbound",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "sessions", ":sessionKey", "network-requests", "outbound"],
              "variable": [
                {
                  "key": "sessionKey",
                  "value": "SESSION_001_ABC123",
                  "description": "The session key"
                }
              ]
            },
            "description": "Get only outbound network requests for a specific session"
          },
          "response": []
        },
        {
          "name": "Get Network Request by ID",
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Accept",
                "value": "application/json",
                "type": "text"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/api/v1/network-requests/:requestId",
              "host": ["{{baseUrl}}"],
              "path": ["api", "v1", "network-requests", ":requestId"],
              "variable": [
                {
                  "key": "requestId",
                  "value": "",
                  "description": "The network request ID from MongoDB"
                }
              ]
            },
            "description": "Get detailed information about a specific network request by its ID"
          },
          "response": []
        }
      ]
    }
  ]
}

spring:
  application:
    name: punchout-gateway
  data:
    mongodb:
      host: localhost
      port: 27017
      database: punchout
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=100,expireAfterWrite=5m
    cache-names:
      - environmentConfig
      - authTokens

server:
  port: 9090

app:
  environment: ${APP_ENVIRONMENT:dev}

# Jasypt encryption configuration
jasypt:
  encryptor:
    password: ${JASYPT_ENCRYPTOR_PASSWORD:punchout-secret-key}
    algorithm: PBEWithMD5AndDES
    iv-generator-classname: org.jasypt.iv.NoIvGenerator

logging:
  level:
    com.waters.punchout.gateway: DEBUG
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} - %logger{36} - %msg%n'

# Customer-specific conversion configuration
punchout:
  conversion:
    customers:
      # Default converter (fallback)
      - id: default
        version: v1
        dialect: CXML
      
      # Acme Corporation  
      - id: acme
        version: v1
        dialect: ARIBA
        match:
          fromIdentityPattern: "buyer123"
        requiredExtrinsics:
          - CostCenter
      
      # TechCorp Industries
      - id: techcorp
        version: v2
        dialect: OCI
        match:
          fromIdentityPattern: "buyer456"
        requiredExtrinsics:
          - CompanyCode
          - UniqueName
      
      # Global Solutions Inc
      - id: global
        version: v1
        dialect: ARIBA
        match:
          fromIdentityPattern: "buyer789"
        requiredExtrinsics:
          - Region
      
      # SAP Ariba Network
      - id: ariba
        version: v1
        dialect: ARIBA
        match:
          fromDomain: AribaNetworkUserId
        requiredExtrinsics:
          - UniqueName
      
      # Coupa Procurement
      - id: coupa
        version: v1
        dialect: CXML
        match:
          senderUserAgentPattern: ".*Coupa.*"
        requiredExtrinsics:
          - requester-email
      
      # Oracle iProcurement / Oracle Cloud
      - id: oracle
        version: v1
        dialect: OCI
        match:
          senderUserAgentPattern: ".*Oracle.*|.*iProcurement.*"
        requiredExtrinsics:
          - OrgId
          - UserId

# Third Party Service URLs
thirdparty:
  auth:
    url: http://localhost:8082/api/v1/token
    timeout: 5000
  mule:
    url: http://localhost:8082/api/v1/catalog
    timeout: 10000

# Resilience4j Configuration
resilience4j:
  circuitbreaker:
    instances:
      authService:
        slidingWindowSize: 10
        minimumNumberOfCalls: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 30s
        permittedNumberOfCallsInHalfOpenState: 5
        automaticTransitionFromOpenToHalfOpenEnabled: true
      muleService:
        slidingWindowSize: 10
        minimumNumberOfCalls: 10
        failureRateThreshold: 50
        waitDurationInOpenState: 30s
        permittedNumberOfCallsInHalfOpenState: 5
        automaticTransitionFromOpenToHalfOpenEnabled: true
  
  retry:
    instances:
      authService:
        maxAttempts: 3
        waitDuration: 1s
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - org.springframework.web.reactive.function.client.WebClientRequestException
          - java.util.concurrent.TimeoutException
      muleService:
        maxAttempts: 3
        waitDuration: 1s
        enableExponentialBackoff: true
        exponentialBackoffMultiplier: 2
        retryExceptions:
          - org.springframework.web.reactive.function.client.WebClientRequestException
          - java.util.concurrent.TimeoutException
  
  timelimiter:
    instances:
      authService:
        timeoutDuration: 30s
      muleService:
        timeoutDuration: 30s
